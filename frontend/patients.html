<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Healthcare Platform - Patients</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/patients.css">
</head>
<body>
    <button onclick="window.location.href='dashboard.html'" class="back-btn" style="margin: 24px 0 0 16px; padding: 8px 18px; border-radius: 8px; border: none; background: #e0eafc; color: #0074d9; font-size: 1em; cursor: pointer; box-shadow: 0 1px 4px rgba(0,0,0,0.06); transition: background 0.2s;">‚Üê Back</button>
    <h2>Patients</h2>
    <form id="addPatientForm">
        <input type="text" id="firstName" placeholder="First Name" required>
        <input type="text" id="lastName" placeholder="Last Name" required>
        <div style="display:flex;align-items:center;gap:8px;">
            <input type="date" id="dob" required style="flex:1;">
            <button type="button" id="fillTodayBtn" title="Fill today" style="padding:4px 10px;font-size:0.95em;background:#e0eafc;color:#0074d9;border:none;border-radius:6px;cursor:pointer;">Today</button>
        </div>
        <input type="text" id="gender" placeholder="Gender" required>
        <input type="text" id="address" placeholder="Address" required>
        <button type="submit">Add Patient</button>
    </form>
    <div id="patientsList" class="patients-list"></div>
    <script>
        // Fill today's date in DOB field
        document.getElementById('fillTodayBtn').onclick = function() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById('dob').value = `${yyyy}-${mm}-${dd}`;
        };
        function getAuth() {
            return {
                username: localStorage.getItem('username'),
                password: localStorage.getItem('password')
            };
        }
            function formatDate(dateStr) {
                if (!dateStr) return '';
                const d = new Date(dateStr);
                if (isNaN(d)) return dateStr;
                return d.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
            }
            async function loadPatients() {
                const { username, password } = getAuth();
                const res = await fetch(`http://localhost:3001/api/patients?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`);
                const patients = await res.json();
                const list = document.getElementById('patientsList');
                list.innerHTML = '';
                if (Array.isArray(patients)) {
                    patients.forEach(p => {
                        const card = document.createElement('div');
                        card.className = 'patient-card';
                        card.innerHTML = `
                            <div class="patient-header">
                                <span class="patient-avatar">üë§</span>
                                <span class="patient-name">${p.FirstName} ${p.LastName}</span>
                                <button class="remove-btn" title="Remove Patient" style="margin-left:auto;background:#ffd6d6;color:#d32f2f;border:none;border-radius:6px;padding:6px 14px;cursor:pointer;font-size:0.98em;">Remove</button>
                            </div>
                            <div class="patient-details">
                                <div><strong>DOB:</strong> ${formatDate(p.DateOfBirth)}</div>
                                <div><strong>Gender:</strong> ${p.Gender || ''}</div>
                                <div><strong>Address:</strong> ${p.Address || ''}</div>
                            </div>
                        `;
                        card.querySelector('.remove-btn').onclick = async function() {
                            if (confirm('Are you sure you want to remove this patient?')) {
                                const { username, password } = getAuth();
                                await fetch(`http://localhost:3001/api/patients/${p.PatientID}?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`, {
                                    method: 'DELETE'
                                });
                                loadPatients();
                            }
                        };
                        list.appendChild(card);
                    });
                } else {
                    list.innerHTML = `<div class="patient-card">${patients.message || 'Access denied'}</div>`;
                }
            }
        document.getElementById('addPatientForm').onsubmit = async function(e) {
            e.preventDefault();
            const { username, password } = getAuth();
            const patient = {
                username,
                password,
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                dob: document.getElementById('dob').value,
                gender: document.getElementById('gender').value,
                address: document.getElementById('address').value
            };
            await fetch('http://localhost:3001/api/patients', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(patient)
            });
            loadPatients();
        };
        loadPatients();
    </script>
</body>
</html>
