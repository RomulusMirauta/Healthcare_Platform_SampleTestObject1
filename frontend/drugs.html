<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Healthcare Platform - Drugs</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/drugs.css">
</head>
<body>
    <button onclick="window.location.href='dashboard.html'" class="back-btn" style="margin: 24px 0 0 16px; padding: 8px 18px; border-radius: 8px; border: none; background: #e0eafc; color: #0074d9; font-size: 1em; cursor: pointer; box-shadow: 0 1px 4px rgba(0,0,0,0.06); transition: background 0.2s;">‚Üê Back</button>
    <h2>Drugs</h2>
    <form id="addDrugForm">
        <input type="text" id="name" placeholder="Drug Name" required>
        <input type="text" id="description" placeholder="Description" required>
        <input type="text" id="dosage" placeholder="Dosage" required>
        <button type="submit">Add Drug</button>
    </form>
    <div id="drugsList" class="drugs-list"></div>
    <script>
        function getAuth() {
            return {
                username: localStorage.getItem('username'),
                password: localStorage.getItem('password')
            };
        }
        async function loadDrugs() {
            const { username, password } = getAuth();
            const res = await fetch(`http://localhost:3001/api/drugs?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`);
            const drugs = await res.json();
            const list = document.getElementById('drugsList');
            list.innerHTML = '';
            if (Array.isArray(drugs)) {
                drugs.forEach(d => {
                    const card = document.createElement('div');
                    card.className = 'drug-card';
                    card.innerHTML = `
                        <div class="drug-header">
                            <span class="drug-icon">üíä</span>
                            <span class="drug-name">${d.Name}</span>
                            <button class="remove-btn" title="Remove Drug" style="margin-left:auto;background:#ffd6d6;color:#d32f2f;border:none;border-radius:6px;padding:6px 14px;cursor:pointer;font-size:0.98em;">Remove</button>
                        </div>
                        <div class="drug-details">
                            <div><strong>Dosage:</strong> ${d.Dosage}</div>
                            <div><strong>Description:</strong> ${d.Description}</div>
                        </div>
                    `;
                    card.querySelector('.remove-btn').onclick = async function() {
                        if (confirm('Are you sure you want to remove this drug?')) {
                            const { username, password } = getAuth();
                            await fetch(`http://localhost:3001/api/drugs/${d.DrugID}?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`, {
                                method: 'DELETE'
                            });
                            loadDrugs();
                        }
                    };
                    list.appendChild(card);
                });
            } else {
                list.innerHTML = `<div class="drug-card">${drugs.message || 'Access denied'}</div>`;
            }
        }
        document.getElementById('addDrugForm').onsubmit = async function(e) {
            e.preventDefault();
            const { username, password } = getAuth();
            const drug = {
                username,
                password,
                name: document.getElementById('name').value,
                description: document.getElementById('description').value,
                dosage: document.getElementById('dosage').value
            };
            await fetch('http://localhost:3001/api/drugs', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(drug)
            });
            loadDrugs();
        };
        loadDrugs();
    </script>
</body>
</html>
